#!/bin/bash

[[ -f ~/.config/user-dirs.dirs ]] && source ~/.config/user-dirs.dirs
OUTPUT_DIR="${OMARCHY_SCREENRECORD_DIR:-${XDG_VIDEOS_DIR:-$HOME/Videos}}"

if [[ ! -d "$OUTPUT_DIR" ]]; then
  notify-send "Screen recording directory does not exist: $OUTPUT_DIR" -u critical -t 3000
  exit 1
fi

# Check if SimpleScreenRecorder is already running
if pgrep -x simplescreenrecorder >/dev/null; then
  # If already running, just bring it to front
  wmctrl -a "SimpleScreenRecorder" 2>/dev/null || true
  notify-send "SimpleScreenRecorder is already running" -t 2000
else
  # Start SimpleScreenRecorder
  case ${1:-region} in
    "output"|"screen")
      # Launch SimpleScreenRecorder for full screen recording
      notify-send "Starting screen recording..." -t 1000
      simplescreenrecorder --start-hidden --settle-time=1000 &
      ;;
    *)
      # Launch SimpleScreenRecorder for region selection
      notify-send "Starting screen recording..." -t 1000
      simplescreenrecorder &
      ;;
  esac
fi
