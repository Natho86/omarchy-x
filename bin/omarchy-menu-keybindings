#!/bin/bash

# A script to display i3 keybindings defined in your configuration
# using rofi for an interactive search menu.

# Parse i3 keybindings from config
parse_i3_bindings() {
  # Read i3 config and extract bindsym lines
  grep -E "^[[:space:]]*bindsym" ~/.config/i3/config ~/.local/share/omarchy/default/i3/config 2>/dev/null | \
    sed -E 's/^[[:space:]]*bindsym[[:space:]]+//' | \
    sed -E 's/exec[[:space:]]+//' | \
    sed -E 's/--no-startup-id[[:space:]]+//' | \
    awk '{
      # Split on first space to separate key from command
      key = $1;
      $1 = "";
      command = $0;
      
      # Clean up key formatting
      gsub(/\$mod/, "SUPER", key);
      gsub(/\+/, " + ", key);
      gsub(/[[:space:]]+/, " ", key);
      gsub(/^[[:space:]]+|[[:space:]]+$/, "", key);
      
      # Clean up command
      gsub(/^[[:space:]]+|[[:space:]]+$/, "", command);
      gsub(/~\/.local\/share\/omarchy\/bin\//, "", command);
      
      # Format output
      if (command != "" && key != "") {
        printf "%-35s → %s\n", key, command;
      }
    }'
}

# Add some common i3 keybindings that might not be in config
add_common_bindings() {
  echo "ALT + Tab                           → Cycle through windows"
  echo "SUPER + SHIFT + Q                   → Quit i3"
  echo "SUPER + SHIFT + R                   → Restart i3"
  echo "SUPER + SHIFT + C                   → Reload i3 config"
  echo "SUPER + R                           → Resize mode"
  echo "SUPER + D                           → Open application launcher"
}

# Combine all bindings and display
{
  parse_i3_bindings
  add_common_bindings
} | sort -u | rofi -dmenu -i -p "i3 Keybindings" -theme-str 'window {width: 80%;}'